<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: frontend/src/pages/steps/seatmaps/containers/MainSeatMapContainer.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: frontend/src/pages/steps/seatmaps/containers/MainSeatMapContainer.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect, useRef, useCallback } from 'react';
import { Typography, Button, Space, notification } from 'antd';
import {
  FullscreenOutlined,
  CompressOutlined,
  InfoCircleOutlined
} from '@ant-design/icons';
import { COLORS, getVenueColors, getContrastColor } from '../../../../components/colorscheme';
import ProSeatRenderer from '../renderers/ProSeatRenderer';
import AltSeatMapLegend from '../ui/AltSeatMapLegend';
import VenueStageRenderer from '../renderers/VenueStageRenderer';
import ZoomControls from '../ui/ZoomControls';
import AccessibilityFeatures from '../ui/AccessibilityFeatures';
import useAdvancedZoomPan from '../../../../hooks/useAdvancedZoomPan';
import '../styles/SeatMapAnimations.css';
import '../styles/SeatMapLayouts.css';

const { Title, Text } = Typography;

/**
 * Top bar component for seat selection with summary and controls
 * @param {Object} props - Component props
 * @param {Array} props.selectedSeats - Currently selected seats
 * @param {number} props.maxSeats - Maximum number of selectable seats
 * @param {Function} props.formatPrice - Price formatting function
 * @param {Object} props.event - Event data object
 * @param {boolean} props.showLegend - Whether legend is visible
 * @param {Function} props.setShowLegend - Legend visibility setter
 * @param {boolean} props.isFullscreen - Whether in fullscreen mode
 * @param {Function} props.toggleFullscreen - Fullscreen toggle function
 * @returns {JSX.Element} Selection top bar with seat summary and controls
 */
const SelectionTopBar = ({ selectedSeats, maxSeats, formatPrice, event, showLegend, setShowLegend, isFullscreen, toggleFullscreen }) => {
  const totalPrice = selectedSeats.reduce((total, seat) => total + (seat.price || 0), 0);
  const [isMobile, setIsMobile] = React.useState(false);

  React.useEffect(() => {
    const handleResize = () => {
      setIsMobile(window.innerWidth &lt; 768);
    };
    handleResize();
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return (
    &lt;div
      style={{
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 100,
        backgroundColor: 'rgba(255, 255, 255, 0.95)',
        backdropFilter: 'blur(10px)',
        padding: isMobile ? '10px 12px' : '12px 16px',
        borderBottom: `1px solid ${COLORS.neutral.grey2}`,
        display: 'flex',
        flexDirection: isMobile ? 'column' : 'row',
        justifyContent: 'space-between',
        alignItems: isMobile ? 'stretch' : 'center',
        gap: isMobile ? '10px' : '0'
      }}
    >
      &lt;div style={{
        display: 'flex',
        flexDirection: isMobile ? 'column' : 'row',
        alignItems: isMobile ? 'flex-start' : 'center',
        gap: isMobile ? '4px' : '12px',
        minWidth: 0,
        flex: isMobile ? 'none' : 1
      }}>
        &lt;Title level={4} style={{
          margin: 0,
          color: COLORS.neutral.darker,
          fontSize: isMobile ? '16px' : '20px',
          whiteSpace: 'nowrap',
          overflow: 'hidden',
          textOverflow: 'ellipsis'
        }}>
          Selecci贸n de asientos
        &lt;/Title>
        &lt;Text style={{
          color: COLORS.neutral.grey600,
          fontSize: isMobile ? '11px' : '12px',
          whiteSpace: isMobile ? 'normal' : 'nowrap',
          lineHeight: '1.3'
        }}>
          Selecciona hasta {maxSeats} asiento(s) para continuar
        &lt;/Text>
      &lt;/div>

      &lt;div style={{
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        gap: isMobile ? '8px' : '16px',
        flexWrap: isMobile ? 'wrap' : 'nowrap',
        justifyContent: isMobile ? 'space-between' : 'flex-end',
        width: isMobile ? '100%' : 'auto'
      }}>
        {/* Informaci贸n de selecci贸n */}
        &lt;div style={{
          display: 'flex',
          alignItems: 'center',
          gap: isMobile ? '8px' : '16px',
          flex: isMobile ? '1 1 auto' : 'none'
        }}>
          &lt;div style={{ textAlign: 'center' }}>
            &lt;Text style={{
              fontSize: isMobile ? '10px' : '12px',
              color: COLORS.neutral.grey600,
              display: 'block',
              whiteSpace: 'nowrap'
            }}>
              Asientos
            &lt;/Text>
            &lt;Text style={{
              fontSize: isMobile ? '14px' : '16px',
              fontWeight: 'bold',
              color: COLORS.primary.main,
              whiteSpace: 'nowrap'
            }}>
              {selectedSeats.length} / {maxSeats}
            &lt;/Text>
          &lt;/div>

          {selectedSeats.length > 0 &amp;&amp; (
            &lt;div style={{ textAlign: 'center' }}>
              &lt;Text style={{
                fontSize: isMobile ? '10px' : '12px',
                color: COLORS.neutral.grey600,
                display: 'block',
                whiteSpace: 'nowrap'
              }}>
                Total
              &lt;/Text>
              &lt;Text style={{
                fontSize: isMobile ? '14px' : '16px',
                fontWeight: 'bold',
                color: COLORS.primary.main,
                whiteSpace: 'nowrap'
              }}>
                {formatPrice(totalPrice)}
              &lt;/Text>
            &lt;/div>
          )}
        &lt;/div>

        {/* Botones de control */}
        {!isMobile &amp;&amp; (
          &lt;Space>
            &lt;Button
              size="small"
              icon={&lt;InfoCircleOutlined />}
              onClick={() => setShowLegend(!showLegend)}
              type={showLegend ? 'primary' : 'default'}
            >
              Leyenda
            &lt;/Button>
            &lt;Button
              size="small"
              icon={isFullscreen ? &lt;CompressOutlined /> : &lt;FullscreenOutlined />}
              onClick={toggleFullscreen}
            >
              {isFullscreen ? 'Salir' : 'Pantalla completa'}
            &lt;/Button>
          &lt;/Space>
        )}
        {/* En m贸vil, solo mostrar iconos sin texto */}
        {isMobile &amp;&amp; (
          &lt;Space size="small">
            &lt;Button
              size="small"
              icon={&lt;InfoCircleOutlined />}
              onClick={() => setShowLegend(!showLegend)}
              type={showLegend ? 'primary' : 'default'}
            />
            &lt;Button
              size="small"
              icon={isFullscreen ? &lt;CompressOutlined /> : &lt;FullscreenOutlined />}
              onClick={toggleFullscreen}
            />
          &lt;/Space>
        )}
      &lt;/div>
    &lt;/div>
  );
};

const MainSeatMapContainer = ({
  seatMapData,
  selectedSeats,
  onSeatSelect,
  maxSeats,
  occupiedSeats,
  blockedSeats,
  blockedSections,
  formatPrice,
  event,
  calculateSeatPrice,
  isAdminMode = false,
  isPreviewMode = false,
  onSectionToggle = null
}) => {
  const [isMobile, setIsMobile] = useState(false);
  const [isTablet, setIsTablet] = useState(false);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const [showLegend, setShowLegend] = useState(false);
  const [hoveredSection, setHoveredSection] = useState(null);

  // Estados de accesibilidad
  const [isHighContrast, setIsHighContrast] = useState(false);
  const [isKeyboardNavigationEnabled, setIsKeyboardNavigationEnabled] = useState(false);
  const [showTooltips, setShowTooltips] = useState(true);

  const containerRef = useRef(null);
  const seatMapRef = useRef(null);

  // Hook avanzado de zoom y pan con soporte t谩ctil completo
  const {
    zoomLevel,
    panOffset,
    isInteracting,
    zoomIn: handleZoomIn,
    zoomOut: handleZoomOut,
    reset: handleResetZoom,
    handlers: zoomPanHandlers
  } = useAdvancedZoomPan({
    minZoom: 0.15,
    maxZoom: 2.5,
    initialZoom: isMobile ? 0.25 : 0.7, // Zoom inicial m谩s bajo en m贸vil para ver todo el mapa amplio
    zoomStep: 0.15,
    enableMouseWheel: true,
    enablePinch: true,
    enablePan: true
  });

  // Detectar tipo de dispositivo
  useEffect(() => {
    const handleResize = () => {
      const width = window.innerWidth;
      setIsMobile(width &lt; 768);
      setIsTablet(width >= 768 &amp;&amp; width &lt; 1024);
    };

    handleResize();
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // Funci贸n para alternar pantalla completa
  const toggleFullscreen = useCallback(() => {
    if (!document.fullscreenElement) {
      containerRef.current?.requestFullscreen();
      setIsFullscreen(true);
    } else {
      document.exitFullscreen();
      setIsFullscreen(false);
    }
  }, []);

  // Manejar cambios de pantalla completa
  useEffect(() => {
    const handleFullscreenChange = () => {
      setIsFullscreen(!!document.fullscreenElement);
    };

    document.addEventListener('fullscreenchange', handleFullscreenChange);
    return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);
  }, []);

  // Centrar el scroll en m贸vil cuando se carga el mapa o cambia el zoom
  useEffect(() => {
    if (isMobile &amp;&amp; seatMapRef.current) {
      const centerScroll = () => {
        const container = seatMapRef.current;
        if (container) {
          const scrollWidth = container.scrollWidth;
          const clientWidth = container.clientWidth;
          const scrollHeight = container.scrollHeight;
          const clientHeight = container.clientHeight;

          const centerX = (scrollWidth - clientWidth) / 2;
          const centerY = (scrollHeight - clientHeight) / 2;

          container.scrollTo({
            left: centerX,
            top: centerY,
            behavior: 'auto'
          });
        }
      };

      // Centrar despu茅s de un breve delay para asegurar que el DOM est茅 actualizado
      const timer = setTimeout(centerScroll, 50);
      return () => clearTimeout(timer);
    }
  }, [isMobile, seatMapData, zoomLevel]);

  if (!seatMapData) return null;

  const { sections, config, type } = seatMapData;
  const venueColors = getVenueColors(type);

  // Filtrar asientos ocupados y bloqueados por secci贸n
  const filterOccupiedBySection = (sectionId) => {
    if (!occupiedSeats || !occupiedSeats.length) return [];
    return occupiedSeats.filter(seatId => seatId &amp;&amp; typeof seatId === 'string' &amp;&amp; seatId.startsWith(sectionId));
  };

  const filterBlockedBySection = (sectionId) => {
    if (!blockedSeats || !blockedSeats.length) return [];
    return blockedSeats.filter(seatId => seatId &amp;&amp; typeof seatId === 'string' &amp;&amp; seatId.startsWith(sectionId));
  };

  const isSectionBlocked = (sectionId) => {
    return blockedSections &amp;&amp; blockedSections.includes(sectionId);
  };

  const getSectionCapacityFromPricing = (sectionId) => {
    if (!event?.sectionPricing) return null;
    const pricing = event.sectionPricing.find(p => p.sectionId === sectionId);
    return pricing ? pricing.capacity : null;
  };

  // Renderizar secci贸n profesional
  const renderProfessionalSection = (section, customProps = {}) => {
    const sectionBlocked = isSectionBlocked(section.id);

    return (
      &lt;div
        key={section.id}
        className="professional-section"
        style={{
          position: 'relative',
          margin: '8px',
          borderRadius: '12px',
          overflow: 'hidden',
          transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
          transform: hoveredSection === section.id ? 'scale(1.02)' : 'scale(1)',
          ...customProps
        }}
        onMouseEnter={() => setHoveredSection(section.id)}
        onMouseLeave={() => setHoveredSection(null)}
      >
        {section.hasNumberedSeats ? (
          &lt;ProSeatRenderer
            sectionId={section.id}
            rows={section.rows}
            seatsPerRow={section.seatsPerRow}
            price={section.defaultPrice || 0}
            color={section.color}
            name={section.name}
            selectedSeats={selectedSeats}
            occupiedSeats={filterOccupiedBySection(section.id)}
            blockedSeats={filterBlockedBySection(section.id)}
            sectionBlocked={sectionBlocked}
            maxSeats={maxSeats}
            onSeatSelect={onSeatSelect}
            formatPrice={formatPrice}
            event={event}
            calculateSeatPrice={calculateSeatPrice}
            sectionPricing={section.sectionPricing}
            venueType={type}
            isAdminMode={isAdminMode}
            isMobile={isMobile}
            isTablet={isTablet}
            showTooltips={showTooltips}
            isHighContrast={isHighContrast}
            onSectionToggle={onSectionToggle}
          />
        ) : (
          &lt;ProfessionalGeneralAdmissionRenderer
            section={section}
            sectionBlocked={sectionBlocked}
            occupiedSeats={filterOccupiedBySection(section.id)}
            formatPrice={formatPrice}
            selectedSeats={selectedSeats}
            onSeatSelect={onSeatSelect}
            maxSeats={maxSeats}
            event={event}
            sectionCapacityFromPricing={getSectionCapacityFromPricing(section.id)}
            venueType={type}
            showTooltips={showTooltips}
            isHighContrast={isHighContrast}
          />
        )}
      &lt;/div>
    );
  };

  // Renderizar layout espec铆fico por tipo de venue
  const renderVenueLayout = () => {
    switch (type) {
      case 'football':
        return renderFootballStadiumLayout();
      case 'concert':
        return renderConcertVenueLayout();
      case 'cinema':
        return renderCinemaLayout();
      case 'theater':
        return renderTheaterLayout();
      case 'arena':
        return renderArenaLayout();
      default:
        return renderGenericLayout();
    }
  };

  // Layout para estadio de f煤tbol
  const renderFootballStadiumLayout = () => {
    const tribunaNorte = sections.find(s => 
      s.id.includes('norte') || s.name.toLowerCase().includes('norte') ||
      s.id.includes('north') || s.name.toLowerCase().includes('north')
    );
    const tribunaEste = sections.find(s => 
      s.id.includes('este') || s.name.toLowerCase().includes('este') ||
      s.id.includes('east') || s.name.toLowerCase().includes('east')
    );
    const tribunaOeste = sections.find(s => 
      s.id.includes('oeste') || s.name.toLowerCase().includes('oeste') ||
      s.id.includes('west') || s.name.toLowerCase().includes('west')
    );
    const tribunaSur = sections.find(s => 
      s.id.includes('sur') || s.name.toLowerCase().includes('sur') ||
      s.id.includes('south') || s.name.toLowerCase().includes('south')
    );
    const vipSection = sections.find(s => s.id.includes('vip') || s.name.toLowerCase().includes('vip'));

    return (
      &lt;div className="football-stadium-layout">
        {/* Tribuna Norte */}
        {tribunaNorte &amp;&amp; (
          &lt;div className="tribuna-norte">
            {renderProfessionalSection(tribunaNorte, {
              gridArea: 'north'
            })}
          &lt;/div>
        )}

        {/* Tribuna Oeste */}
        {tribunaOeste &amp;&amp; (
          &lt;div className="tribuna-oeste">
            {renderProfessionalSection(tribunaOeste, {
              gridArea: 'west'
            })}
          &lt;/div>
        )}

        {/* Campo central */}
        &lt;div className="field-container" style={{ gridArea: 'center' }}>
          &lt;VenueStageRenderer
            type="football"
            config={config}
            venueColors={venueColors}
          />
        &lt;/div>

        {/* Tribuna Este */}
        {tribunaEste &amp;&amp; (
          &lt;div className="tribuna-este">
            {renderProfessionalSection(tribunaEste, {
              gridArea: 'east'
            })}
          &lt;/div>
        )}

        {/* Tribuna Sur */}
        {tribunaSur &amp;&amp; (
          &lt;div className="tribuna-sur">
            {renderProfessionalSection(tribunaSur, {
              gridArea: 'south'
            })}
          &lt;/div>
        )}

        {/* VIP */}
        {vipSection &amp;&amp; (
          &lt;div className="vip-section">
            {renderProfessionalSection(vipSection, {
              gridArea: 'vip'
            })}
          &lt;/div>
        )}
      &lt;/div>
    );
  };

  // Layout para venue de concierto
  const renderConcertVenueLayout = () => {
    
    // Detectar si es un concierto tipo estadio o tipo teatro
    const hasDirectionalSections = sections.some(s => 
      s.id.includes('norte') || s.id.includes('sur') || s.id.includes('este') || s.id.includes('oeste') ||
      s.name.toLowerCase().includes('norte') || s.name.toLowerCase().includes('sur') ||
      s.name.toLowerCase().includes('este') || s.name.toLowerCase().includes('oeste')
    );

    if (hasDirectionalSections) {
      // Layout tipo estadio para conciertos
      return renderConcertStadiumLayout();
    } else {
      // Layout tipo teatro para conciertos
      return renderConcertTheaterLayout();
    }
  };

  // Layout de concierto tipo estadio
  const renderConcertStadiumLayout = () => {
    const tribunaNorte = sections.find(s =>
      s.id.includes('norte') || s.name.toLowerCase().includes('norte') ||
      s.id.includes('north') || s.name.toLowerCase().includes('north')
    );
    const tribunaEste = sections.find(s =>
      s.id.includes('este') || s.name.toLowerCase().includes('este') ||
      s.id.includes('east') || s.name.toLowerCase().includes('east')
    );
    const tribunaOeste = sections.find(s =>
      s.id.includes('oeste') || s.name.toLowerCase().includes('oeste') ||
      s.id.includes('west') || s.name.toLowerCase().includes('west')
    );
    const tribunaSur = sections.find(s =>
      s.id.includes('sur') || s.name.toLowerCase().includes('sur') ||
      s.id.includes('south') || s.name.toLowerCase().includes('south')
    );
    const pistaSection = sections.find(s =>
      !s.hasNumberedSeats ||
      s.id.includes('pista') || s.name.toLowerCase().includes('pista') ||
      s.id.includes('general') || s.name.toLowerCase().includes('general')
    );
    const vipPremiumSections = sections.filter(s =>
      s.id.includes('vip') || s.name.toLowerCase().includes('vip') ||
      s.id.includes('palco') || s.name.toLowerCase().includes('palco') ||
      s.id.includes('premium') || s.name.toLowerCase().includes('premium')
    );

    return (
      &lt;div className="concert-stadium-layout">
        {/* Tribuna Norte */}
        {tribunaNorte &amp;&amp; (
          &lt;div className="tribuna-norte">
            {renderProfessionalSection(tribunaNorte, { gridArea: 'north' })}
          &lt;/div>
        )}

        {/* Tribuna Oeste */}
        {tribunaOeste &amp;&amp; (
          &lt;div className="tribuna-oeste">
            {renderProfessionalSection(tribunaOeste, { gridArea: 'west' })}
          &lt;/div>
        )}

        {/* Escenario central */}
        &lt;div className="stage-container" style={{ gridArea: 'center' }}>
          &lt;VenueStageRenderer
            type="concert"
            config={config}
            venueColors={venueColors}
          />
        &lt;/div>

        {/* Pista */}
        {pistaSection &amp;&amp; (
          &lt;div className="pit-area">
            {renderProfessionalSection(pistaSection)}
          &lt;/div>
        )}

        {/* Tribuna Este */}
        {tribunaEste &amp;&amp; (
          &lt;div className="tribuna-este">
            {renderProfessionalSection(tribunaEste, { gridArea: 'east' })}
          &lt;/div>
        )}

        {/* Tribuna Sur */}
        {tribunaSur &amp;&amp; (
          &lt;div className="tribuna-sur">
            {renderProfessionalSection(tribunaSur, { gridArea: 'south' })}
          &lt;/div>
        )}

        {/* VIP y Palcos Premium */}
        {vipPremiumSections.length > 0 &amp;&amp; (
          &lt;div className="vip-premium-sections">
            {vipPremiumSections.map(section => (
              &lt;div key={section.id} className="vip-section">
                {renderProfessionalSection(section, { gridArea: 'vip' })}
              &lt;/div>
            ))}
          &lt;/div>
        )}
      &lt;/div>
    );
  };

  // Layout de concierto tipo teatro
  const renderConcertTheaterLayout = () => {
    const pistaSection = sections.find(s =>
      !s.hasNumberedSeats ||
      s.id.includes('pista') || s.name.toLowerCase().includes('pista') ||
      s.id.includes('general') || s.name.toLowerCase().includes('general')
    );
    const vipPremiumSections = sections.filter(s =>
      s.id.includes('vip') || s.name.toLowerCase().includes('vip') ||
      s.id.includes('palco') || s.name.toLowerCase().includes('palco') ||
      s.id.includes('premium') || s.name.toLowerCase().includes('premium')
    );
    const gradas = sections.filter(s =>
      s.hasNumberedSeats &amp;&amp;
      !s.id.includes('vip') &amp;&amp;
      !s.id.includes('palco') &amp;&amp;
      !s.id.includes('premium') &amp;&amp;
      !s.name.toLowerCase().includes('vip') &amp;&amp;
      !s.name.toLowerCase().includes('palco') &amp;&amp;
      !s.name.toLowerCase().includes('premium')
    );

    return (
      &lt;div className="concert-theater-layout">
        {/* Escenario */}
        &lt;div className="stage-container">
          &lt;VenueStageRenderer
            type="concert"
            config={config}
            venueColors={venueColors}
          />
        &lt;/div>

        {/* Pista */}
        {pistaSection &amp;&amp; (
          &lt;div className="pista-section">
            {renderProfessionalSection(pistaSection)}
          &lt;/div>
        )}

        {/* Gradas */}
        &lt;div className="gradas-container">
          {gradas.map(section => renderProfessionalSection(section))}
        &lt;/div>

        {/* VIP y Palcos Premium */}
        {vipPremiumSections.length > 0 &amp;&amp; (
          &lt;div className="vip-premium-sections">
            {vipPremiumSections.map(section => (
              &lt;div key={section.id} className="vip-section">
                {renderProfessionalSection(section)}
              &lt;/div>
            ))}
          &lt;/div>
        )}
      &lt;/div>
    );
  };

  // Layout para cine
  const renderCinemaLayout = () => {
    const premiumSection = sections.find(s => 
      s.id.includes('premium') || s.name.toLowerCase().includes('premium')
    );
    const frontSection = sections.find(s => 
      s.id.includes('front') || s.name.toLowerCase().includes('front') ||
      s.id.includes('delante') || s.name.toLowerCase().includes('delante')
    );
    const middleSection = sections.find(s => 
      s.id.includes('middle') || s.name.toLowerCase().includes('middle') ||
      s.id.includes('medio') || s.name.toLowerCase().includes('medio')
    );
    const backSection = sections.find(s => 
      s.id.includes('back') || s.name.toLowerCase().includes('back') ||
      s.id.includes('atr谩s') || s.name.toLowerCase().includes('atr谩s') ||
      s.id.includes('atras') || s.name.toLowerCase().includes('atras')
    );
    const vipSection = sections.find(s => s.id.includes('vip') || s.name.toLowerCase().includes('vip'));

    return (
      &lt;div className="cinema-layout">
        {/* Pantalla */}
        &lt;div className="screen-container">
          &lt;VenueStageRenderer
            type="cinema"
            config={config}
            venueColors={venueColors}
          />
        &lt;/div>

        {/* VIP (si existe) */}
        {vipSection &amp;&amp; (
          &lt;div className="vip-section">
            {renderProfessionalSection(vipSection)}
          &lt;/div>
        )}

        {/* Premium (si existe) */}
        {premiumSection &amp;&amp; (
          &lt;div className="premium-section">
            {renderProfessionalSection(premiumSection)}
          &lt;/div>
        )}

        {/* Fila delantera */}
        {frontSection &amp;&amp; (
          &lt;div className="front-section">
            {renderProfessionalSection(frontSection)}
          &lt;/div>
        )}

        {/* Fila media */}
        {middleSection &amp;&amp; (
          &lt;div className="middle-section">
            {renderProfessionalSection(middleSection)}
          &lt;/div>
        )}

        {/* Fila trasera */}
        {backSection &amp;&amp; (
          &lt;div className="back-section">
            {renderProfessionalSection(backSection)}
          &lt;/div>
        )}
      &lt;/div>
    );
  };

  // Layout para teatro
  const renderTheaterLayout = () => {
    const orchestraSection = sections.find(s =>
      s.id.includes('orchestra') || s.name.toLowerCase().includes('orchestra') ||
      s.id.includes('orquesta') || s.name.toLowerCase().includes('orquesta')
    );
    const mezzanineSection = sections.find(s =>
      s.id.includes('mezzanine') || s.name.toLowerCase().includes('mezzanine') ||
      s.id.includes('mezanine') || s.name.toLowerCase().includes('mezanine')
    );
    const balconySection = sections.find(s =>
      s.id.includes('balcony') || s.name.toLowerCase().includes('balcony') ||
      s.id.includes('balc贸n') || s.name.toLowerCase().includes('balc贸n')
    );
    const boxesSection = sections.find(s =>
      s.id.includes('boxes') || s.name.toLowerCase().includes('boxes') ||
      s.id.includes('palcos') || s.name.toLowerCase().includes('palcos')
    );
    // VIP section solo si no es parte de boxes (palcos)
    const vipSection = sections.find(s =>
      (s.id.includes('vip') || s.name.toLowerCase().includes('vip')) &amp;&amp;
      !s.id.includes('boxes') &amp;&amp; !s.name.toLowerCase().includes('boxes') &amp;&amp;
      !s.id.includes('palcos') &amp;&amp; !s.name.toLowerCase().includes('palcos')
    );

    return (
      &lt;div className="theater-layout">
        {/* Escenario */}
        &lt;div className="stage-container">
          &lt;VenueStageRenderer
            type="theater"
            config={config}
            venueColors={venueColors}
          />
        &lt;/div>

        {/* Palcos (si existen) */}
        {boxesSection &amp;&amp; (
          &lt;div className="boxes-section">
            {renderProfessionalSection(boxesSection)}
          &lt;/div>
        )}

        {/* Orquesta */}
        {orchestraSection &amp;&amp; (
          &lt;div className="orchestra-section">
            {renderProfessionalSection(orchestraSection)}
          &lt;/div>
        )}

        {/* Mezzanine */}
        {mezzanineSection &amp;&amp; (
          &lt;div className="mezzanine-section">
            {renderProfessionalSection(mezzanineSection)}
          &lt;/div>
        )}

        {/* Balc贸n */}
        {balconySection &amp;&amp; (
          &lt;div className="balcony-section">
            {renderProfessionalSection(balconySection)}
          &lt;/div>
        )}

        {/* VIP */}
        {vipSection &amp;&amp; (
          &lt;div className="vip-section">
            {renderProfessionalSection(vipSection)}
          &lt;/div>
        )}
      &lt;/div>
    );
  };

  // Layout para arena
  const renderArenaLayout = () => {
    const pistaSection = sections.find(s => s.id.includes('pista'));
    const lowerSections = sections.filter(s => s.id.includes('lower'));
    const upperSections = sections.filter(s => s.id.includes('upper'));
    const vipSections = sections.filter(s => s.id.includes('vip'));

    return (
      &lt;div className="arena-layout">
        {/* VIP */}
        {vipSections.length > 0 &amp;&amp; (
          &lt;div className="vip-container">
            {vipSections.map(section => renderProfessionalSection(section))}
          &lt;/div>
        )}

        {/* Secciones superiores */}
        {upperSections.length > 0 &amp;&amp; (
          &lt;div className="upper-sections">
            {upperSections.map(section => renderProfessionalSection(section))}
          &lt;/div>
        )}

        {/* Escenario */}
        &lt;div className="stage-container">
          &lt;VenueStageRenderer
            type="arena"
            config={config}
            venueColors={venueColors}
          />
        &lt;/div>

        {/* Pista */}
        {pistaSection &amp;&amp; (
          &lt;div className="pista-section">
            {renderProfessionalSection(pistaSection)}
          &lt;/div>
        )}

        {/* Secciones inferiores */}
        {lowerSections.length > 0 &amp;&amp; (
          &lt;div className="lower-sections">
            {lowerSections.map(section => renderProfessionalSection(section))}
          &lt;/div>
        )}
      &lt;/div>
    );
  };

  // Layout gen茅rico
  const renderGenericLayout = () => {
    const sortedSections = [...sections].sort((a, b) => (a.order || 0) - (b.order || 0));

    return (
      &lt;div className="generic-layout">
        {sortedSections.map(section => renderProfessionalSection(section))}
      &lt;/div>
    );
  };

  return (
    &lt;div
      ref={containerRef}
      className={`professional-seatmap-container ${isFullscreen ? 'fullscreen' : ''} ${isHighContrast ? 'high-contrast' : ''}`}
      style={{
        position: 'relative',
        maxWidth: isPreviewMode ? '100%' : (isFullscreen ? '100%' : '2400px'),
        minHeight: isPreviewMode ? '600px' : (isMobile ? '80vh' : '150vh'),
        backgroundColor: COLORS.neutral.grey50,
        borderRadius: isFullscreen ? '0' : (isPreviewMode ? '0' : '16px'),
        overflow: 'hidden', // Cambiar a hidden para contener el contenido
        boxShadow: isFullscreen ? 'none' : (isPreviewMode ? 'none' : COLORS.shadows.xl),
        margin: isPreviewMode ? '0' : '0 auto'
      }}
    >
      {/* Barra superior de selecci贸n de asientos - Solo en modo usuario y no en vista previa */}
      {!isAdminMode &amp;&amp; !isPreviewMode &amp;&amp; (
        &lt;SelectionTopBar 
          selectedSeats={selectedSeats}
          maxSeats={maxSeats}
          formatPrice={formatPrice}
          event={event}
          showLegend={showLegend}
          setShowLegend={setShowLegend}
          isFullscreen={isFullscreen}
          toggleFullscreen={toggleFullscreen}
        />
      )}
      
      {/* Caracter铆sticas de accesibilidad */}
      &lt;AccessibilityFeatures
        onHighContrastToggle={setIsHighContrast}
        onKeyboardNavigationToggle={setIsKeyboardNavigationEnabled}
        onTooltipToggle={setShowTooltips}
        isHighContrast={isHighContrast}
        isKeyboardNavigationEnabled={isKeyboardNavigationEnabled}
        showTooltips={showTooltips}
        isMobile={isMobile}
      />
        {/* Controles de zoom */}
        &lt;div style={{
          position: 'absolute',
          top: isAdminMode ? (isMobile ? '10px' : '250px') : ((!isAdminMode &amp;&amp; !isPreviewMode) ? '70px' : '10px'),
          right: isMobile ? '10px' : (isAdminMode ? '120px' : '10px'),
          zIndex: 150
        }}>
          &lt;ZoomControls
            zoomLevel={zoomLevel}
            onZoomIn={handleZoomIn}
            onZoomOut={handleZoomOut}
            onReset={handleResetZoom}
            onFullscreen={toggleFullscreen}
            isFullscreen={isFullscreen}
            isMobile={isMobile}
          />
        &lt;/div>

        {/* Contenedor principal del mapa */}
        &lt;div
          ref={seatMapRef}
          className="seatmap-content"
          style={{
            position: 'relative',
            width: '100%',
            height: '100%',
            overflow: isMobile ? 'auto' : 'hidden', // En m贸vil permitir scroll, en desktop usar pan
            cursor: !isMobile &amp;&amp; isInteracting ? 'grabbing' : (isMobile ? 'auto' : 'grab'),
            display: isMobile ? 'block' : 'flex',
            justifyContent: isMobile ? 'initial' : 'center',
            alignItems: isMobile ? 'initial' : 'center',
            padding: 0,
            flex: 1,
            touchAction: isMobile ? 'pan-x pan-y pinch-zoom' : 'none', // En m贸vil permitir scroll nativo + pinch zoom
            WebkitUserSelect: 'none',
            userSelect: 'none',
            WebkitOverflowScrolling: 'touch', // Scroll suave en iOS
            minHeight: isMobile ? 'calc(80vh - 100px)' : '100%' // Restar espacio para top bar en m贸vil
          }}
          onWheel={!isMobile ? zoomPanHandlers.onWheel : undefined}
          onMouseDown={!isMobile ? zoomPanHandlers.onMouseDown : undefined}
          onTouchStart={zoomPanHandlers.onTouchStart}
          onTouchMove={zoomPanHandlers.onTouchMove}
          onTouchEnd={zoomPanHandlers.onTouchEnd}
        >
          {isMobile ? (
            // En m贸vil: wrapper adicional para centrado con scroll
            &lt;div
              style={{
                display: 'inline-block',
                minWidth: '100%',
                minHeight: '100%',
                textAlign: 'center',
                padding: '50vh 50vw', // Padding para permitir centrado con scroll
                boxSizing: 'content-box'
              }}
            >
              &lt;div
                className="seatmap-transform"
                style={{
                  transform: `scale(${zoomLevel})`,
                  transformOrigin: 'center center',
                  transition: isInteracting ? 'none' : 'transform 0.2s cubic-bezier(0.4, 0, 0.2, 1)',
                  display: 'inline-block',
                  width: 'fit-content',
                  height: 'fit-content',
                  position: 'relative',
                  minWidth: '1400px',
                  willChange: isInteracting ? 'transform' : 'auto'
                }}
              >
                {renderVenueLayout()}
              &lt;/div>
            &lt;/div>
          ) : (
            // En desktop: comportamiento normal con pan
            &lt;div
              className="seatmap-transform"
              style={{
                transform: `translate(${panOffset.x}px, ${panOffset.y}px) scale(${zoomLevel})`,
                transformOrigin: 'center center',
                transition: isInteracting ? 'none' : 'transform 0.2s cubic-bezier(0.4, 0, 0.2, 1)',
                width: 'fit-content',
                height: 'fit-content',
                position: 'relative',
                minWidth: 'auto',
                minHeight: 'auto',
                maxWidth: 'none',
                maxHeight: 'none',
                willChange: isInteracting ? 'transform' : 'auto'
              }}
            >
              {renderVenueLayout()}
            &lt;/div>
          )}
        &lt;/div>

        {/* Leyenda - No mostrar en modo de vista previa */}
        {showLegend &amp;&amp; !isPreviewMode &amp;&amp; (
          &lt;div 
            className="seatmap-legend"
            style={{
              position: 'absolute',
              top: !isAdminMode ? '70px' : '10px',
              left: '50%',
              transform: 'translateX(-50%)',
              zIndex: 10,
              pointerEvents: 'none'
            }}
          >
            &lt;AltSeatMapLegend
              venueType={type}
              showPremium={true}
              showAccessible={true}
              isMobile={isMobile}
            />
          &lt;/div>
        )}

    &lt;/div>
  );
};

// Componente para entrada general profesional
const ProfessionalGeneralAdmissionRenderer = ({
  section,
  sectionBlocked,
  formatPrice,
  selectedSeats,
  occupiedSeats = [],
  onSeatSelect,
  maxSeats,
  event,
  sectionCapacityFromPricing,
  venueType,
  showTooltips = true,
  isHighContrast = false
}) => {
  const sameSectionSelected = selectedSeats.filter(s => s.sectionId === section.id);
  const selectedCount = sameSectionSelected.length;

  const pricingCapacity = sectionCapacityFromPricing;
  const occupiedCount = occupiedSeats.filter(seatId => seatId.startsWith(section.id)).length;
  const totalCapacity = pricingCapacity || section.totalCapacity || 0;
  const remainingCapacity = Math.max(totalCapacity - occupiedCount, 0);
  const capacityPercentage = totalCapacity > 0 ? ((totalCapacity - remainingCapacity) / totalCapacity) * 100 : 0;

  const isFullyBooked = sectionBlocked || remainingCapacity &lt;= 0;
  const isNearCapacity = capacityPercentage > 80;

  // Obtener el color de la secci贸n o usar un color por defecto
  const sectionColor = section.color || COLORS.primary.main;

  // Calcular el color de texto con buen contraste sobre el fondo de la secci贸n
  const textColor = getContrastColor(sectionColor, COLORS.neutral.white, COLORS.neutral.darker);

  const handleSectionClick = () => {
    if (isFullyBooked) return;

    if (sameSectionSelected.length >= remainingCapacity) {
      notification.warning({
        message: 'Capacidad insuficiente',
        description: `Solo quedan ${remainingCapacity} entradas disponibles en esta secci贸n.`,
        placement: 'topRight'
      });
      return;
    }

    let correctPrice = section.defaultPrice || 0;
    if (event &amp;&amp; event.usesSectionPricing &amp;&amp; event.sectionPricing?.length > 0) {
      const eventSectionPricing = event.sectionPricing.find(sp => sp.sectionId === section.id);
      if (eventSectionPricing) {
        correctPrice = eventSectionPricing.defaultPrice || section.defaultPrice || 0;
      }
    }

    const sectionData = {
      id: `${section.id}-GA-${Date.now()}`,
      section: section.name,
      sectionId: section.id,
      price: correctPrice,
      isGeneralAdmission: true
    };

    if (selectedSeats.length &lt; maxSeats) {
      onSeatSelect([...selectedSeats, sectionData]);
    }
  };

  if (isFullyBooked) {
    return (
      &lt;div
        style={{
          minWidth: '380px',
          padding: '40px',
          background: '#F3F4F6',
          border: '3px dashed #D1D5DB',
          borderRadius: '20px',
          textAlign: 'center',
          color: '#9CA3AF',
          opacity: 0.7
        }}
      >
        &lt;div style={{ fontSize: '32px', marginBottom: '12px' }}>锔&lt;/div>
        &lt;div style={{ fontWeight: 'bold', fontSize: '20px', marginBottom: '6px' }}>AGOTADO&lt;/div>
        &lt;div style={{ fontSize: '16px' }}>No hay entradas disponibles&lt;/div>
      &lt;/div>
    );
  }

  return (
    &lt;div
      onClick={handleSectionClick}
      style={{
        minWidth: '420px',
        maxWidth: '480px',
        padding: '36px 44px',
        background: `linear-gradient(135deg, ${sectionColor}E6 0%, ${sectionColor}D9 100%)`,
        border: `3px solid ${sectionColor}`,
        borderRadius: '24px',
        cursor: 'pointer',
        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
        boxShadow: selectedCount > 0
          ? `0 8px 32px ${sectionColor}40, 0 0 0 4px ${sectionColor}20`
          : `0 4px 16px rgba(0,0,0,0.08)`,
        transform: selectedCount > 0 ? 'scale(1.02)' : 'scale(1)',
        position: 'relative',
        overflow: 'visible'
      }}
      onMouseEnter={(e) => {
        e.currentTarget.style.transform = 'scale(1.02)';
        e.currentTarget.style.boxShadow = `0 8px 32px ${sectionColor}40`;
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.transform = selectedCount > 0 ? 'scale(1.02)' : 'scale(1)';
        e.currentTarget.style.boxShadow = selectedCount > 0
          ? `0 8px 32px ${sectionColor}40, 0 0 0 4px ${sectionColor}20`
          : `0 4px 16px rgba(0,0,0,0.08)`;
      }}
    >
      {/* Indicador de color de secci贸n */}
      &lt;div style={{
        width: '32px',
        height: '32px',
        backgroundColor: sectionColor,
        borderRadius: '50%',
        margin: '0 auto 16px',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        fontSize: '18px',
        boxShadow: `0 4px 12px ${sectionColor}60`
      }}>
        
      &lt;/div>

      {/* Nombre de la secci贸n */}
      &lt;div style={{
        fontSize: '18px',
        fontWeight: '700',
        color: textColor,
        textAlign: 'center',
        marginBottom: '20px',
        textTransform: 'uppercase',
        letterSpacing: '1px'
      }}>
        {section.name}
      &lt;/div>

      {/* Contador de entradas seleccionadas */}
      {selectedCount > 0 &amp;&amp; (
        &lt;div style={{
          backgroundColor: `${sectionColor}`,
          color: '#FFFFFF',
          padding: '20px',
          borderRadius: '16px',
          marginBottom: '20px',
          textAlign: 'center',
          boxShadow: `0 6px 20px ${sectionColor}50`
        }}>
          &lt;div style={{
            fontSize: '48px',
            fontWeight: '900',
            lineHeight: '1',
            marginBottom: '8px'
          }}>
            {selectedCount}
          &lt;/div>
          &lt;div style={{
            fontSize: '14px',
            fontWeight: '600',
            textTransform: 'uppercase',
            letterSpacing: '0.5px',
            opacity: 0.95
          }}>
            {selectedCount === 1 ? 'Entrada seleccionada' : 'Entradas seleccionadas'}
          &lt;/div>
        &lt;/div>
      )}

      {/* Barra de capacidad */}
      &lt;div style={{
        width: '100%',
        height: '8px',
        backgroundColor: `${sectionColor}40`,
        borderRadius: '4px',
        marginBottom: '12px',
        overflow: 'hidden'
      }}>
        &lt;div
          style={{
            height: '100%',
            width: `${capacityPercentage}%`,
            backgroundColor: sectionColor,
            borderRadius: '4px',
            transition: 'width 0.3s ease'
          }}
        />
      &lt;/div>

      {/* Informaci贸n de capacidad */}
      &lt;div style={{
        fontSize: '15px',
        color: textColor,
        textAlign: 'center',
        marginBottom: '20px',
        fontWeight: '500',
        opacity: 0.9
      }}>
        {remainingCapacity} de {totalCapacity} disponibles
        {isNearCapacity &amp;&amp; (
          &lt;div style={{
            color: '#EF4444',
            fontSize: '13px',
            marginTop: '4px',
            fontWeight: '600'
          }}>
            隆Pocas quedan!
          &lt;/div>
        )}
      &lt;/div>

      {/* Precio */}
      &lt;div style={{
        padding: '14px 28px',
        background: `${sectionColor}`,
        borderRadius: '12px',
        textAlign: 'center',
        fontSize: '24px',
        fontWeight: '700',
        color: '#FFFFFF',
        boxShadow: `0 4px 12px ${sectionColor}40`
      }}>
        {(() => {
          let correctPrice = section.defaultPrice || 0;
          if (event &amp;&amp; event.usesSectionPricing &amp;&amp; event.sectionPricing?.length > 0) {
            const eventSectionPricing = event.sectionPricing.find(sp => sp.sectionId === section.id);
            if (eventSectionPricing) {
              correctPrice = eventSectionPricing.defaultPrice || section.defaultPrice || 0;
            }
          }
          return formatPrice(correctPrice);
        })()}
      &lt;/div>

      {/* Indicador de "Click para seleccionar" */}
      {selectedCount === 0 &amp;&amp; (
        &lt;div style={{
          marginTop: '16px',
          fontSize: '13px',
          color: textColor,
          textAlign: 'center',
          fontWeight: '600',
          opacity: 0.8
        }}>
          Click para a帽adir entrada
        &lt;/div>
      )}
    &lt;/div>
  );
};

export default MainSeatMapContainer;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-components_colorscheme.html">components/colorscheme</a></li><li><a href="module-models_Event.html">models/Event</a></li><li><a href="module-models_Location.html">models/Location</a></li><li><a href="module-models_SeatMap.html">models/SeatMap</a></li><li><a href="module-models_Ticket.html">models/Ticket</a></li><li><a href="module-models_User.html">models/User</a></li><li><a href="module-services_UserService.html">services/UserService</a></li><li><a href="module-utils_api.html">utils/api</a></li><li><a href="module-utils_authSession.html">utils/authSession</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AboutUs">AboutUs</a></li><li><a href="global.html#AdminDashboard">AdminDashboard</a></li><li><a href="global.html#AdminStatistics">AdminStatistics</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#BlockingViewSwitcher">BlockingViewSwitcher</a></li><li><a href="global.html#EditProfile">EditProfile</a></li><li><a href="global.html#EditableSeatRenderer">EditableSeatRenderer</a></li><li><a href="global.html#ErrorPage">ErrorPage</a></li><li><a href="global.html#EventCreation">EventCreation</a></li><li><a href="global.html#EventDetails">EventDetails</a></li><li><a href="global.html#FramedImage">FramedImage</a></li><li><a href="global.html#GeneralAdmissionRenderer">GeneralAdmissionRenderer</a></li><li><a href="global.html#GenericSeatRenderer">GenericSeatRenderer</a></li><li><a href="global.html#HelpCenter">HelpCenter</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#ManualBlockingSelection">ManualBlockingSelection</a></li><li><a href="global.html#ManualSeatSelection">ManualSeatSelection</a></li><li><a href="global.html#Profile">Profile</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#RowPricingTable">RowPricingTable</a></li><li><a href="global.html#SeatMapContainer">SeatMapContainer</a></li><li><a href="global.html#SeatRenderer">SeatRenderer</a></li><li><a href="global.html#SeatSelectionViewSwitcher">SeatSelectionViewSwitcher</a></li><li><a href="global.html#SectionShapeRenderer">SectionShapeRenderer</a></li><li><a href="global.html#SelectionTopBar">SelectionTopBar</a></li><li><a href="global.html#TicketPurchase">TicketPurchase</a></li><li><a href="global.html#VenueStageRenderer">VenueStageRenderer</a></li><li><a href="global.html#ZoomControls">ZoomControls</a></li><li><a href="global.html#enviarEmailConfirmacionCompra">enviarEmailConfirmacionCompra</a></li><li><a href="global.html#generateTicketNumber">generateTicketNumber</a></li><li><a href="global.html#generateToken">generateToken</a></li><li><a href="global.html#generateValidationCode">generateValidationCode</a></li><li><a href="global.html#returnError">returnError</a></li><li><a href="global.html#tokens">tokens</a></li><li><a href="global.html#transporter">transporter</a></li><li><a href="global.html#useAdvancedZoomPan">useAdvancedZoomPan</a></li><li><a href="global.html#useDeviceDetection">useDeviceDetection</a></li><li><a href="global.html#useUserRole">useUserRole</a></li><li><a href="global.html#verifyAdmin">verifyAdmin</a></li><li><a href="global.html#verifyAuthenticated">verifyAuthenticated</a></li><li><a href="global.html#verifyOwnership">verifyOwnership</a></li><li><a href="global.html#verifyPayPalPayment">verifyPayPalPayment</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Nov 13 2025 19:24:33 GMT+0100 (hora est谩ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
