<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: frontend/src/pages/steps/seatmaps/components/ManualSeatSelection.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: frontend/src/pages/steps/seatmaps/components/ManualSeatSelection.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useMemo } from 'react';
import { Card, Select, InputNumber, Button, Typography, Alert, List, Tag, Space, notification } from 'antd';
import { PlusOutlined, DeleteOutlined, CheckCircleOutlined } from '@ant-design/icons';
import { COLORS } from '../../../../components/colorscheme';

const { Title, Text } = Typography;
const { Option } = Select;

/**
 * Componente de selección manual de asientos mediante formulario
 * @param {Object} props - Propiedades del componente
 * @param {Object} props.seatMapData - Datos del mapa de asientos
 * @param {Array} props.selectedSeats - Asientos actualmente seleccionados
 * @param {Function} props.onSeatSelect - Función para actualizar asientos seleccionados
 * @param {number} props.maxSeats - Número máximo de asientos seleccionables
 * @param {Array} props.occupiedSeats - Lista de IDs de asientos ocupados
 * @param {Array} props.blockedSeats - Lista de IDs de asientos bloqueados
 * @param {Array} props.blockedSections - Lista de IDs de secciones bloqueadas
 * @param {Function} props.formatPrice - Función para formatear precios
 * @param {Object} props.event - Datos del evento
 */
const ManualSeatSelection = ({
  seatMapData,
  selectedSeats = [],
  onSeatSelect,
  maxSeats,
  occupiedSeats = [],
  blockedSeats = [],
  blockedSections = [],
  formatPrice,
  event
}) => {
  const [selectedSection, setSelectedSection] = useState(null);
  const [selectedRow, setSelectedRow] = useState(null);
  const [selectedSeatNumber, setSelectedSeatNumber] = useState(null);

  // Obtener información de la sección seleccionada
  const currentSection = useMemo(() => {
    if (!seatMapData || !selectedSection) return null;
    return seatMapData.sections.find(s => s.id === selectedSection);
  }, [selectedSection, seatMapData]);

  // Calcular total
  const totalPrice = useMemo(() => {
    return selectedSeats.reduce((total, seat) => total + (seat.price || 0), 0);
  }, [selectedSeats]);

  if (!seatMapData) return null;

  const { sections } = seatMapData;

  // Verificar si la sección está bloqueada
  const isSectionBlocked = (sectionId) => {
    return blockedSections &amp;&amp; blockedSections.includes(sectionId);
  };

  // Obtener precio del asiento
  const getSeatPrice = (section, row) => {
    if (!section) return 0;

    // Si el evento usa pricing por secciones
    if (event &amp;&amp; event.usesSectionPricing &amp;&amp; event.sectionPricing?.length > 0) {
      const sectionPricing = event.sectionPricing.find(sp => sp.sectionId === section.id);

      if (sectionPricing) {
        // Si usa pricing por filas y la fila está especificada
        if (event.usesRowPricing &amp;&amp; row &amp;&amp; sectionPricing.rowPricing &amp;&amp; sectionPricing.rowPricing.length > 0) {
          const rowPrice = sectionPricing.rowPricing.find(rp => rp.row === row);
          if (rowPrice) {
            return rowPrice.price;
          }
        }
        // Si no hay precio específico por fila, usar defaultPrice de la sección
        return sectionPricing.defaultPrice || section.defaultPrice || 0;
      }
    }

    // Fallback al precio por defecto de la sección
    return section.defaultPrice || 0;
  };

  // Validar disponibilidad del asiento
  const isSeatAvailable = (sectionId, row, seat) => {
    const seatId = `${sectionId}-${row}-${seat}`;

    // Verificar si la sección está bloqueada
    if (isSectionBlocked(sectionId)) return false;

    // Verificar si el asiento está ocupado
    if (occupiedSeats.includes(seatId)) return false;

    // Verificar si el asiento está bloqueado
    if (blockedSeats.includes(seatId)) return false;

    // Verificar si ya está seleccionado
    if (selectedSeats.some(s => s.id === seatId)) return false;

    return true;
  };

  // Manejar cambio de sección
  const handleSectionChange = (sectionId) => {
    setSelectedSection(sectionId);
    setSelectedRow(null);
    setSelectedSeatNumber(null);
  };

  // Agregar asiento seleccionado
  const handleAddSeat = () => {
    if (!currentSection) {
      notification.warning({
        message: 'Selección incompleta',
        description: 'Por favor, selecciona una sección.',
        placement: 'topRight'
      });
      return;
    }

    // Si es entrada general
    if (!currentSection.hasNumberedSeats) {
      // Verificar capacidad disponible
      const sectionOccupiedCount = occupiedSeats.filter(seatId =>
        seatId.startsWith(currentSection.id)
      ).length;

      const totalCapacity = currentSection.totalCapacity || 0;
      const remainingCapacity = totalCapacity - sectionOccupiedCount;

      if (remainingCapacity &lt;= 0 || isSectionBlocked(currentSection.id)) {
        notification.error({
          message: 'Sección no disponible',
          description: 'Esta sección está completa o bloqueada.',
          placement: 'topRight'
        });
        return;
      }

      // Verificar límite de selección
      if (selectedSeats.length >= maxSeats) {
        notification.warning({
          message: 'Límite alcanzado',
          description: `Solo puedes seleccionar hasta ${maxSeats} asientos.`,
          placement: 'topRight'
        });
        return;
      }

      const price = getSeatPrice(currentSection, null);
      const seatData = {
        id: `${currentSection.id}-GA-${Date.now()}`,
        section: currentSection.name,
        sectionId: currentSection.id,
        price: price,
        isGeneralAdmission: true
      };

      onSeatSelect([...selectedSeats, seatData]);
      notification.success({
        message: 'Asiento agregado',
        description: `${currentSection.name} - Entrada General`,
        placement: 'topRight'
      });
      return;
    }

    // Para asientos numerados
    if (!selectedRow || !selectedSeatNumber) {
      notification.warning({
        message: 'Selección incompleta',
        description: 'Por favor, selecciona fila y asiento.',
        placement: 'topRight'
      });
      return;
    }

    // Validar disponibilidad
    if (!isSeatAvailable(currentSection.id, selectedRow, selectedSeatNumber)) {
      notification.error({
        message: 'Asiento no disponible',
        description: 'Este asiento ya está ocupado, bloqueado o seleccionado.',
        placement: 'topRight'
      });
      return;
    }

    // Verificar límite de selección
    if (selectedSeats.length >= maxSeats) {
      notification.warning({
        message: 'Límite alcanzado',
        description: `Solo puedes seleccionar hasta ${maxSeats} asientos.`,
        placement: 'topRight'
      });
      return;
    }

    const price = getSeatPrice(currentSection, selectedRow);
    const seatId = `${currentSection.id}-${selectedRow}-${selectedSeatNumber}`;
    const seatData = {
      id: seatId,
      section: currentSection.name,
      sectionId: currentSection.id,
      row: selectedRow,
      seat: selectedSeatNumber,
      price: price
    };

    onSeatSelect([...selectedSeats, seatData]);
    notification.success({
      message: 'Asiento agregado',
      description: `${currentSection.name} - Fila ${selectedRow}, Asiento ${selectedSeatNumber}`,
      placement: 'topRight'
    });

    // Resetear selección de fila y asiento
    setSelectedRow(null);
    setSelectedSeatNumber(null);
  };

  // Eliminar asiento de la selección
  const handleRemoveSeat = (seatId) => {
    const newSeats = selectedSeats.filter(s => s.id !== seatId);
    onSeatSelect(newSeats);
    notification.info({
      message: 'Asiento eliminado',
      description: 'El asiento ha sido eliminado de tu selección.',
      placement: 'topRight'
    });
  };

  return (
    &lt;div style={{
      padding: '12px',
      maxWidth: '100%',
      width: '100%',
      margin: '0 auto',
      boxSizing: 'border-box',
      overflow: 'hidden'
    }}>
      &lt;Title level={3} style={{
        marginBottom: '16px',
        textAlign: 'center',
        fontSize: 'clamp(18px, 4vw, 24px)',
        wordWrap: 'break-word'
      }}>
        Selección manual de asientos
      &lt;/Title>

      &lt;Alert
        message="Instrucciones"
        description="Selecciona la sección, fila y asiento deseado. Para entrada general, solo necesitas seleccionar la sección."
        type="info"
        showIcon
        style={{
          marginBottom: '16px',
          fontSize: 'clamp(12px, 2vw, 14px)'
        }}
      />

      {/* Formulario de selección */}
      &lt;Card
        style={{
          marginBottom: '16px',
          borderRadius: '12px',
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
          overflow: 'hidden'
        }}
      >
        &lt;Space direction="vertical" size="large" style={{ width: '100%' }}>
          {/* Selector de sección */}
          &lt;div>
            &lt;Text strong style={{ display: 'block', marginBottom: '8px' }}>
              Sección &lt;span style={{ color: '#ff4d4f' }}>*&lt;/span>
            &lt;/Text>
            &lt;Select
              placeholder="Selecciona una sección"
              style={{ width: '100%' }}
              value={selectedSection}
              onChange={handleSectionChange}
              size="large"
            >
              {sections.map(section => {
                const blocked = isSectionBlocked(section.id);
                return (
                  &lt;Option
                    key={section.id}
                    value={section.id}
                    disabled={blocked}
                  >
                    &lt;div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      width: '100%',
                      overflow: 'hidden'
                    }}>
                      &lt;span style={{
                        flex: 1,
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        whiteSpace: 'nowrap',
                        marginRight: '8px'
                      }}>
                        {section.name}
                        {!section.hasNumberedSeats &amp;&amp; ' (Entrada General)'}
                      &lt;/span>
                      {blocked &amp;&amp; &lt;Tag color="red" style={{ flexShrink: 0 }}>Bloqueada&lt;/Tag>}
                    &lt;/div>
                  &lt;/Option>
                );
              })}
            &lt;/Select>
          &lt;/div>

          {/* Selectores de fila y asiento (solo para asientos numerados) */}
          {currentSection &amp;&amp; currentSection.hasNumberedSeats &amp;&amp; (
            &lt;>
              &lt;div>
                &lt;Text strong style={{ display: 'block', marginBottom: '8px' }}>
                  Fila &lt;span style={{ color: '#ff4d4f' }}>*&lt;/span>
                &lt;/Text>
                &lt;InputNumber
                  placeholder="Número de fila"
                  style={{ width: '100%' }}
                  min={1}
                  max={currentSection.rows}
                  value={selectedRow}
                  onChange={setSelectedRow}
                  size="large"
                />
                &lt;Text type="secondary" style={{ fontSize: '12px', display: 'block', marginTop: '4px' }}>
                  Rango válido: 1 - {currentSection.rows}
                &lt;/Text>
              &lt;/div>

              &lt;div>
                &lt;Text strong style={{ display: 'block', marginBottom: '8px' }}>
                  Asiento &lt;span style={{ color: '#ff4d4f' }}>*&lt;/span>
                &lt;/Text>
                &lt;InputNumber
                  placeholder="Número de asiento"
                  style={{ width: '100%' }}
                  min={1}
                  max={currentSection.seatsPerRow}
                  value={selectedSeatNumber}
                  onChange={setSelectedSeatNumber}
                  size="large"
                />
                &lt;Text type="secondary" style={{ fontSize: '12px', display: 'block', marginTop: '4px' }}>
                  Rango válido: 1 - {currentSection.seatsPerRow}
                &lt;/Text>
              &lt;/div>
            &lt;/>
          )}

          {/* Información de precio */}
          {currentSection &amp;&amp; (
            &lt;div style={{
              padding: '16px',
              backgroundColor: COLORS.neutral.grey1,
              borderRadius: '8px',
              marginTop: '8px'
            }}>
              &lt;Space direction="vertical" style={{ width: '100%' }}>
                &lt;div style={{ display: 'flex', justifyContent: 'space-between' }}>
                  &lt;Text>Sección seleccionada:&lt;/Text>
                  &lt;Text strong>{currentSection.name}&lt;/Text>
                &lt;/div>
                {currentSection.hasNumberedSeats &amp;&amp; selectedRow &amp;&amp; (
                  &lt;div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    &lt;Text>Precio:&lt;/Text>
                    &lt;Text strong style={{ color: COLORS.primary.main }}>
                      {formatPrice(getSeatPrice(currentSection, selectedRow))}
                    &lt;/Text>
                  &lt;/div>
                )}
                {!currentSection.hasNumberedSeats &amp;&amp; (
                  &lt;div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    &lt;Text>Precio:&lt;/Text>
                    &lt;Text strong style={{ color: COLORS.primary.main }}>
                      {formatPrice(getSeatPrice(currentSection, null))}
                    &lt;/Text>
                  &lt;/div>
                )}
              &lt;/Space>
            &lt;/div>
          )}

          {/* Botón agregar */}
          &lt;Button
            type="primary"
            size="large"
            icon={&lt;PlusOutlined />}
            onClick={handleAddSeat}
            disabled={!currentSection || (currentSection.hasNumberedSeats &amp;&amp; (!selectedRow || !selectedSeatNumber)) || selectedSeats.length >= maxSeats}
            block
          >
            Agregar asiento
          &lt;/Button>
        &lt;/Space>
      &lt;/Card>

      {/* Lista de asientos seleccionados */}
      {selectedSeats.length > 0 &amp;&amp; (
        &lt;Card
          title={
            &lt;div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              flexWrap: 'wrap',
              gap: '8px'
            }}>
              &lt;span style={{ fontSize: 'clamp(14px, 3vw, 16px)' }}>
                Asientos seleccionados ({selectedSeats.length}/{maxSeats})
              &lt;/span>
              &lt;Text strong style={{
                color: COLORS.primary.main,
                fontSize: 'clamp(14px, 3vw, 18px)',
                whiteSpace: 'nowrap'
              }}>
                Total: {formatPrice(totalPrice)}
              &lt;/Text>
            &lt;/div>
          }
          style={{
            borderRadius: '12px',
            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
            border: `2px solid ${COLORS.primary.main}`,
            overflow: 'hidden'
          }}
        >
          &lt;List
            dataSource={selectedSeats}
            renderItem={(seat) => (
              &lt;List.Item
                actions={[
                  &lt;Button
                    type="text"
                    danger
                    icon={&lt;DeleteOutlined />}
                    onClick={() => handleRemoveSeat(seat.id)}
                  >
                    Eliminar
                  &lt;/Button>
                ]}
              >
                &lt;List.Item.Meta
                  avatar={&lt;CheckCircleOutlined style={{ fontSize: '24px', color: COLORS.primary.main }} />}
                  title={
                    &lt;Space>
                      &lt;Text strong>{seat.section}&lt;/Text>
                      {seat.isGeneralAdmission &amp;&amp; &lt;Tag color="green">Entrada General&lt;/Tag>}
                    &lt;/Space>
                  }
                  description={
                    seat.isGeneralAdmission
                      ? 'Entrada General'
                      : `Fila ${seat.row}, Asiento ${seat.seat}`
                  }
                />
                &lt;Text strong style={{ color: COLORS.primary.main }}>
                  {formatPrice(seat.price)}
                &lt;/Text>
              &lt;/List.Item>
            )}
          />
        &lt;/Card>
      )}

      {/* Mensaje si no hay asientos seleccionados */}
      {selectedSeats.length === 0 &amp;&amp; (
        &lt;Alert
          message="No hay asientos seleccionados"
          description="Usa el formulario anterior para agregar asientos a tu selección."
          type="warning"
          showIcon
        />
      )}
    &lt;/div>
  );
};

export default ManualSeatSelection;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-components_colorscheme.html">components/colorscheme</a></li><li><a href="module-models_Event.html">models/Event</a></li><li><a href="module-models_Location.html">models/Location</a></li><li><a href="module-models_SeatMap.html">models/SeatMap</a></li><li><a href="module-models_Ticket.html">models/Ticket</a></li><li><a href="module-models_User.html">models/User</a></li><li><a href="module-services_UserService.html">services/UserService</a></li><li><a href="module-utils_api.html">utils/api</a></li><li><a href="module-utils_authSession.html">utils/authSession</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AboutUs">AboutUs</a></li><li><a href="global.html#AdminDashboard">AdminDashboard</a></li><li><a href="global.html#AdminStatistics">AdminStatistics</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#BlockingViewSwitcher">BlockingViewSwitcher</a></li><li><a href="global.html#EditProfile">EditProfile</a></li><li><a href="global.html#EditableSeatRenderer">EditableSeatRenderer</a></li><li><a href="global.html#ErrorPage">ErrorPage</a></li><li><a href="global.html#EventCreation">EventCreation</a></li><li><a href="global.html#EventDetails">EventDetails</a></li><li><a href="global.html#FramedImage">FramedImage</a></li><li><a href="global.html#GeneralAdmissionRenderer">GeneralAdmissionRenderer</a></li><li><a href="global.html#GenericSeatRenderer">GenericSeatRenderer</a></li><li><a href="global.html#HelpCenter">HelpCenter</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#ManualBlockingSelection">ManualBlockingSelection</a></li><li><a href="global.html#ManualSeatSelection">ManualSeatSelection</a></li><li><a href="global.html#Profile">Profile</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#RowPricingTable">RowPricingTable</a></li><li><a href="global.html#SeatMapContainer">SeatMapContainer</a></li><li><a href="global.html#SeatRenderer">SeatRenderer</a></li><li><a href="global.html#SeatSelectionViewSwitcher">SeatSelectionViewSwitcher</a></li><li><a href="global.html#SectionShapeRenderer">SectionShapeRenderer</a></li><li><a href="global.html#SelectionTopBar">SelectionTopBar</a></li><li><a href="global.html#TicketPurchase">TicketPurchase</a></li><li><a href="global.html#VenueStageRenderer">VenueStageRenderer</a></li><li><a href="global.html#ZoomControls">ZoomControls</a></li><li><a href="global.html#enviarEmailConfirmacionCompra">enviarEmailConfirmacionCompra</a></li><li><a href="global.html#generateTicketNumber">generateTicketNumber</a></li><li><a href="global.html#generateToken">generateToken</a></li><li><a href="global.html#generateValidationCode">generateValidationCode</a></li><li><a href="global.html#returnError">returnError</a></li><li><a href="global.html#tokens">tokens</a></li><li><a href="global.html#transporter">transporter</a></li><li><a href="global.html#useAdvancedZoomPan">useAdvancedZoomPan</a></li><li><a href="global.html#useDeviceDetection">useDeviceDetection</a></li><li><a href="global.html#useUserRole">useUserRole</a></li><li><a href="global.html#verifyAdmin">verifyAdmin</a></li><li><a href="global.html#verifyAuthenticated">verifyAuthenticated</a></li><li><a href="global.html#verifyOwnership">verifyOwnership</a></li><li><a href="global.html#verifyPayPalPayment">verifyPayPalPayment</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Nov 12 2025 23:46:54 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
