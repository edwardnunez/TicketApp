<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: backend/ticketservice/ticket-model.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: backend/ticketservice/ticket-model.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Modelo de datos de Ticket para MongoDB
 * @module models/Ticket
 */

import mongoose from 'mongoose';

/**
 * Schema para información de asiento individual dentro de un ticket
 * @typedef {Object} SeatSchema
 * @property {string} id - Identificador único del asiento
 * @property {string} sectionId - Identificador de la sección
 * @property {number} row - Número de fila (opcional para entrada general)
 * @property {number} seat - Número de asiento (opcional para entrada general)
 * @property {number} price - Precio de este asiento
 * @property {boolean} isGeneralAdmission - Bandera que indica si es un asiento de entrada general
 */
const seatSchema = new mongoose.Schema({
  id: { type: String, required: true },
  sectionId: { type: String, required: true },
  row: { type: Number, required: false },
  seat: { type: Number, required: false },
  price: { type: Number, required: true },
  isGeneralAdmission: { type: Boolean, default: false }
}, { _id: false });

/**
 * Definición del schema de Ticket
 * @typedef {Object} TicketSchema
 * @property {mongoose.Schema.Types.ObjectId} userId - Referencia al usuario que compró el ticket
 * @property {mongoose.Schema.Types.ObjectId} eventId - Referencia al evento
 * @property {SeatSchema[]} selectedSeats - Array de asientos seleccionados (numerados o entrada general)
 * @property {number} price - Precio total del ticket
 * @property {number} quantity - Número de tickets comprados
 * @property {string} status - Estado del ticket (pending, paid, cancelled)
 * @property {string} qrCode - Código QR único para validación del ticket
 * @property {string} ticketNumber - Número de ticket único
 * @property {string} validationCode - Código de validación para verificación manual
 * @property {Date} purchasedAt - Fecha y hora de compra
 */
const ticketSchema = new mongoose.Schema({
  userId: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true },
  eventId: { type: mongoose.Schema.Types.ObjectId, required: true },
  selectedSeats: [seatSchema],
  price: { type: Number, required: true },
  quantity: { type: Number, required: true },
  status: { type: String, enum: ['pending', 'paid', 'cancelled'], default: 'pending' },

  qrCode: { type: String, required: true, unique: true },
  ticketNumber: { type: String, required: true, unique: true },
  validationCode: { type: String, required: true },

  purchasedAt: { type: Date, default: Date.now }
});

/**
 * Índices de rendimiento para consultas eficientes
 */
ticketSchema.index({ eventId: 1, 'selectedSeats.id': 1, status: 1 });
ticketSchema.index({ userId: 1, status: 1 });
ticketSchema.index({ ticketNumber: 1 }, { unique: true });
ticketSchema.index({ qrCode: 1 }, { unique: true });

/**
 * Modelo de Ticket para operaciones de base de datos
 * @type {mongoose.Model}
 */
const Ticket = mongoose.model("Ticket", ticketSchema);

export default Ticket;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-components_colorscheme.html">components/colorscheme</a></li><li><a href="module-hooks_useSeatMapViability.html">hooks/useSeatMapViability</a></li><li><a href="module-models_Event.html">models/Event</a></li><li><a href="module-models_Location.html">models/Location</a></li><li><a href="module-models_SeatMap.html">models/SeatMap</a></li><li><a href="module-models_Ticket.html">models/Ticket</a></li><li><a href="module-models_User.html">models/User</a></li><li><a href="module-services_UserService.html">services/UserService</a></li><li><a href="module-utils_authSession.html">utils/authSession</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AboutUs">AboutUs</a></li><li><a href="global.html#AdminDashboard">AdminDashboard</a></li><li><a href="global.html#AdminStatistics">AdminStatistics</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#BlockingViewSwitcher">BlockingViewSwitcher</a></li><li><a href="global.html#EditProfile">EditProfile</a></li><li><a href="global.html#EditableSeatRenderer">EditableSeatRenderer</a></li><li><a href="global.html#ErrorPage">ErrorPage</a></li><li><a href="global.html#EventCreation">EventCreation</a></li><li><a href="global.html#EventDetails">EventDetails</a></li><li><a href="global.html#FramedImage">FramedImage</a></li><li><a href="global.html#GeneralAdmissionRenderer">GeneralAdmissionRenderer</a></li><li><a href="global.html#GenericSeatRenderer">GenericSeatRenderer</a></li><li><a href="global.html#HelpCenter">HelpCenter</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#ManualBlockingSelection">ManualBlockingSelection</a></li><li><a href="global.html#ManualSeatSelection">ManualSeatSelection</a></li><li><a href="global.html#Navbar">Navbar</a></li><li><a href="global.html#Profile">Profile</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#RowPricingTable">RowPricingTable</a></li><li><a href="global.html#SeatMapContainer">SeatMapContainer</a></li><li><a href="global.html#SeatRenderer">SeatRenderer</a></li><li><a href="global.html#SeatSelectionViewSwitcher">SeatSelectionViewSwitcher</a></li><li><a href="global.html#SectionShapeRenderer">SectionShapeRenderer</a></li><li><a href="global.html#SelectionTopBar">SelectionTopBar</a></li><li><a href="global.html#TicketPurchase">TicketPurchase</a></li><li><a href="global.html#VenueStageRenderer">VenueStageRenderer</a></li><li><a href="global.html#ZoomControls">ZoomControls</a></li><li><a href="global.html#enviarEmailConfirmacionCompra">enviarEmailConfirmacionCompra</a></li><li><a href="global.html#generateTicketNumber">generateTicketNumber</a></li><li><a href="global.html#generateValidationCode">generateValidationCode</a></li><li><a href="global.html#returnError">returnError</a></li><li><a href="global.html#transporter">transporter</a></li><li><a href="global.html#useAdvancedZoomPan">useAdvancedZoomPan</a></li><li><a href="global.html#useDeviceDetection">useDeviceDetection</a></li><li><a href="global.html#useUserRole">useUserRole</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Oct 23 2025 19:08:08 GMT+0200 (hora de verano de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
